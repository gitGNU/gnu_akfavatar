# Makefile template for AKFAvatar
# Copyright (C) 2007, 2008, 2009 Andreas K. Foerster
#
# This Makefile template is free software; you have unlimited permission
# to copy, distribute and modify it.

# if you change this, you also have to change the file avatar-default.c
default_avatar = $(srcdir)/male_user.xpm

SHELL = /bin/sh
INSTALL_PROGRAM = $(INSTALL) -m 755
INSTALL_DATA = $(INSTALL) -m 644

SOX = sox

# Soundfile for the alert (\a)
# may be any format that sox supports
# should be higher quality; it will be converted into the needed format
ALERT = $(srcdir)/alert.flac

# names for packages
PKGNAME = akfavatar-$(VERSION).$(SUBVERSION).$(REVISION)$(VARIANT)
BINPKGNAME = akfavatar-$(VERSION).$(SUBVERSION).$(REVISION)$(VARIANT).bin


.PHONY: all check doc txt info install install-strip installdirs uninstall \
	html dvi pdf ps man install-html install-dvi install-pdf install-ps \
	clean mostlyclean distclean maintainer-clean maintainerclean dist \
	mingw dist-mingw

all: $(BUILD)

default: libakfavatar.so libakfavatar.a libavtaddons.a avatarsay avatarsay-d \
	example lua-akfavatar lua-akfavatar-d
	@echo '*'
	@echo '* use "make install" or "make install-strip"'
	@echo '* with root-privileges to install it.'
	@echo '*'

mingw:
	$(MAKE) -f $(srcdir)/mingw/Makefile \
	  srcdir="$(srcdir)" CFLAGS="$(CFLAGS)" LDFLAGS="$(LDFLAGS)" \
	  all

dist-mingw:
	$(MAKE) -f $(srcdir)/mingw/Makefile srcdir=$(srcdir) dist-bin

Makefile: $(srcdir)/configure $(srcdir)/Makefile.in
	./config.status

# alert.au should be in the sourcecode-distribution
$(srcdir)/alert.au: $(ALERT)
	$(SOX) $(ALERT) --comment "" -e mu-law -c 1 $@ rate -l 8k

alert.c: $(srcdir)/alert.au
	$(AWK) -f $(srcdir)/data2c -v name=avt_alert_data \
	  $(srcdir)/alert.au > $@

filechooser.o: $(srcdir)/filechooser.c \
                $(srcdir)/akfavatar.h $(srcdir)/avtaddons.h
	$(CC) $(SDL_CFLAGS) $(CFLAGS) -c -o $@ $(srcdir)/filechooser.c

colorchooser.o: $(srcdir)/colorchooser.c $(srcdir)/akfavatar.h
	$(CC) $(CFLAGS) -c -o $@ $(srcdir)/colorchooser.c

rgb.h: $(srcdir)/rgb.txt
	$(AWK) -f $(srcdir)/rgb2c $(srcdir)/rgb.txt > $@

avatar.o: $(srcdir)/avatar.c $(srcdir)/akfavatar.h version.h rgb.h \
          $(srcdir)/balloonpointer.xbm $(srcdir)/circle.xbm \
          $(srcdir)/btn.xpm $(srcdir)/btn_yes.xbm $(srcdir)/btn_no.xbm \
          $(srcdir)/btn_up.xbm $(srcdir)/btn_down.xbm \
          $(srcdir)/btn_left.xbm $(srcdir)/btn_right.xbm \
          $(srcdir)/btn_ff.xbm $(srcdir)/btn_fb.xbm \
          $(srcdir)/btn_pause.xbm $(srcdir)/btn_stop.xbm \
          $(srcdir)/btn_help.xbm $(srcdir)/btn_cancel.xbm \
          $(srcdir)/btn_eject.xbm $(srcdir)/btn_circle.xbm \
          $(srcdir)/akfavatar.xpm
	$(CC) $(SDL_CFLAGS) $(CFLAGS) -I. -c $(srcdir)/avatar.c

avatar-default.o: $(srcdir)/avatar-default.c $(default_avatar) $(srcdir)/akfavatar.h
	$(CC) $(SDL_CFLAGS) $(CFLAGS) -I. -c -o $@ $(srcdir)/avatar-default.c

avatar-audio.o: $(srcdir)/avatar-audio.c $(srcdir)/akfavatar.h alert.c
	$(CC) $(SDL_CFLAGS) $(CFLAGS) -I. -c -o $@ $(srcdir)/avatar-audio.c

ucsfont7x14.c: $(srcdir)/7x14.bdf
	$(AWK) -f $(srcdir)/bdf2c $(srcdir)/7x14.bdf > $@

ucsfont9x18.c: $(srcdir)/9x18.bdf
	$(AWK) -f $(srcdir)/bdf2c $(srcdir)/9x18.bdf > $@

font.o: $(srcdir)/font.c ucsfont7x14.c ucsfont9x18.c
	$(CC) $(SDL_CFLAGS) $(CFLAGS) -I. -c -o $@ $(srcdir)/font.c

libakfavatar.a: avatar.o avatar-default.o avatar-audio.o font.o
	$(AR) rcu $@ avatar.o avatar-default.o avatar-audio.o font.o
	-$(RANLIB) $@

avatar.lo: $(srcdir)/avatar.c $(srcdir)/akfavatar.h version.h rgb.h \
           $(srcdir)/balloonpointer.xbm $(srcdir)/circle.xbm \
           $(srcdir)/btn.xpm $(srcdir)/btn_yes.xbm $(srcdir)/btn_no.xbm \
           $(srcdir)/btn_up.xbm $(srcdir)/btn_down.xbm \
           $(srcdir)/btn_left.xbm $(srcdir)/btn_right.xbm \
           $(srcdir)/btn_ff.xbm $(srcdir)/btn_fb.xbm \
           $(srcdir)/btn_pause.xbm $(srcdir)/btn_stop.xbm \
           $(srcdir)/btn_help.xbm $(srcdir)/btn_cancel.xbm \
           $(srcdir)/btn_eject.xbm $(srcdir)/btn_circle.xbm \
           $(srcdir)/akfavatar.xpm
	$(CC) $(SDL_CFLAGS) $(CFLAGS) -I. -c -fPIC -o $@ $(srcdir)/avatar.c

avatar-default.lo: $(srcdir)/avatar-default.c $(default_avatar) $(srcdir)/akfavatar.h
	$(CC) $(SDL_CFLAGS) $(CFLAGS) -I. -c -fPIC -o $@ \
	  $(srcdir)/avatar-default.c

avatar-audio.lo: $(srcdir)/avatar-audio.c $(srcdir)/akfavatar.h alert.c
	$(CC) $(SDL_CFLAGS) $(CFLAGS) -I. -c -fPIC -o $@ \
	  $(srcdir)/avatar-audio.c

font.lo: $(srcdir)/font.c ucsfont7x14.c ucsfont9x18.c
	$(CC) $(SDL_CFLAGS) $(CFLAGS) -I. -c -fPIC -o $@ $(srcdir)/font.c

libakfavatar.so: avatar.lo avatar-default.lo avatar-audio.lo font.lo
	$(CC) -shared \
	      -Wl,-soname,$(SONAME) -o $(LIBNAME) -fPIC \
	      avatar.lo avatar-default.lo avatar-audio.lo font.lo \
	      $(SDL_LDFLAGS) $(LDFLAGS)
	-ln -sf $(LIBNAME) $(SONAME)
	-ln -sf $(LIBNAME) libakfavatar.so

example: $(srcdir)/example.c libakfavatar.so
	$(CC) $(CFLAGS) -I. -o $@ $(srcdir)/example.c \
	  -L. -lakfavatar $(LDFLAGS) $(LOCAL_GCC_RPATH)

avtccio.o: $(srcdir)/avtccio.c $(srcdir)/avtaddons.h $(srcdir)/akfavatar.h
	$(CC) $(CFLAGS) -I. -c -o $@ $(srcdir)/avtccio.c

avtcwio.o: $(srcdir)/avtcwio.c $(srcdir)/avtaddons.h $(srcdir)/akfavatar.h
	$(CC) $(CFLAGS) -I. -c -o $@ $(srcdir)/avtcwio.c

avtreadfile.o: $(srcdir)/avtreadfile.c $(srcdir)/avtaddons.h
	$(CC) $(CFLAGS) -I. -c -o $@ $(srcdir)/avtreadfile.c

avatarsay.o: $(srcdir)/avatarsay.c $(srcdir)/akfavatar.h $(srcdir)/avtaddons.h
	$(CC) $(SDL_CFLAGS) $(CFLAGS) -DPREFIX=\"$(exec_prefix)\" -I. \
	  -c -o $@ $(srcdir)/avatarsay.c

avtterm.o: $(srcdir)/avtterm.c $(srcdir)/avtaddons.h $(srcdir)/akfavatar.h
	$(CC) $(SDL_CFLAGS) $(CFLAGS) -I. -c -o $@ $(srcdir)/avtterm.c

avttermsys.o: $(srcdir)/avttermsys.c $(srcdir)/avttermsys.h \
                $(srcdir)/akfavatar.h version.h
	$(CC) $(SDL_CFLAGS) $(CFLAGS) -I. -c -o $@ $(srcdir)/avttermsys.c

avtmsg.o: $(srcdir)/avtmsg.c $(srcdir)/avtaddons.h
	$(CC) $(CFLAGS) -c -o $@ $(srcdir)/avtmsg.c

arch.o: $(srcdir)/arch.c $(srcdir)/avtaddons.h
	$(CC) $(CFLAGS) -c -o $@ $(srcdir)/arch.c

libavtaddons.a: filechooser.o avtterm.o avttermsys.o arch.o \
                avtccio.o avtcwio.o avtmsg.o avtreadfile.o colorchooser.o
	$(AR) rcu $@ filechooser.o avtterm.o avttermsys.o arch.o \
	             avtccio.o avtcwio.o avtmsg.o avtreadfile.o \
	             colorchooser.o
	-$(RANLIB) $@

avtposix.o: $(srcdir)/avtposix.c
	$(CC) $(SDL_CFLAGS) $(CFLAGS) -c -o $@ $(srcdir)/avtposix.c

# avatarsay dynamically linked
# only works, when the library is installed
avatarsay-d: avatarsay.o avtposix.o libavtaddons.a libakfavatar.so
	$(CC) -o $@ avatarsay.o avtposix.o -L. -lavtaddons -lakfavatar \
	  $(LDFLAGS) $(AVATARSAY_LDFLAGS)

# avatarsay dynamically linked, with local rpath if possible
avatarsay: avatarsay.o avtposix.o libavtaddons.a libakfavatar.so
	$(CC) -o $@ avatarsay.o avtposix.o -L. -lavtaddons -lakfavatar \
	  $(LDFLAGS) $(AVATARSAY_LDFLAGS) $(LOCAL_GCC_RPATH)

# avatarsay with statical libakfavatar.a
avatarsay-s: avatarsay.o avtposix.o libavtaddons.a libakfavatar.a
	$(CC) -o $@ avatarsay.o avtposix.o -L. -lavtaddons libakfavatar.a \
	   $(SDL_LDFLAGS) $(LDFLAGS) $(AVATARSAY_LDFLAGS)

# lua-akfavatar dynamically linked
# only works, when the library is installed
lua-akfavatar-d: lua-akfavatar-prg.o lua-avt.o libavtaddons.a
	$(CC) -o $@ lua-akfavatar-prg.o lua-avt.o \
	     -L. -lavtaddons -lakfavatar \
	     $(LUA_LDFLAGS) $(LDFLAGS)

# avatarsay dynamically linked, with local rpath if possible
lua-akfavatar: lua-akfavatar-prg.o lua-avt.o libavtaddons.a
	$(CC) -o $@ lua-akfavatar-prg.o lua-avt.o \
	     -L. -lavtaddons -lakfavatar \
	     $(LUA_LDFLAGS) $(LDFLAGS) $(LOCAL_GCC_RPATH)

lua-akfavatar-prg.o: $(srcdir)/lua/lua-akfavatar-prg.c
	$(CC) $(CFLAGS) $(LUA_CFLAGS) -I$(srcdir) -c -o $@ \
	  $(srcdir)/lua/lua-akfavatar-prg.c

lua-avt.o: $(srcdir)/lua/lua-avt.c
	$(CC) $(CFLAGS) $(LUA_CFLAGS) -I$(srcdir) -c -o $@ \
	  $(srcdir)/lua/lua-avt.c

# Lua-Module -- should not be used as such, yet (unsolved problem)
lua-akfavatar.so: lua-avt.lo filechooser.lo colorchooser.lo avtmsg.lo
	$(CC) -o $@ -shared -fpic lua-avt.lo filechooser.lo colorchooser.lo \
	     avtmsg.lo -L. -lakfavatar \
	     $(LUA_LDFLAGS) $(LDFLAGS) $(LOCAL_GCC_RPATH)

lua-avt.lo: $(srcdir)/lua/lua-avt.c
	  $(CC) $(SDL_CFLAGS) $(CFLAGS) $(LUA_CFLAGS) -I. -c -fpic -o $@ \
	  $(srcdir)/lua/lua-avt.c

filechooser.lo: $(srcdir)/filechooser.c $(srcdir)/avtaddons.h
	$(CC) $(SDL_CFLAGS) $(CFLAGS) -I. -c -fpic -o $@ \
	  $(srcdir)/filechooser.c

colorchooser.lo: $(srcdir)/colorchooser.c $(srcdir)/avtaddons.h
	$(CC) $(SDL_CFLAGS) $(CFLAGS) -I. -c -fpic -o $@ \
	  $(srcdir)/colorchooser.c

avtmsg.lo: $(srcdir)/filechooser.c $(srcdir)/avtaddons.h
	$(CC) $(SDL_CFLAGS) $(CFLAGS) -I. -c -fpic -o $@ \
	  $(srcdir)/avtmsg.c

installdirs:
	-[ -d $(DESTDIR)$(includedir) ]  || $(INSTALL) -d $(DESTDIR)$(includedir)
	-[ -d $(DESTDIR)$(libdir) ]      || $(INSTALL) -d $(DESTDIR)$(libdir)
	-[ -d $(DESTDIR)$(bindir) ]      || $(INSTALL) -d $(DESTDIR)$(bindir)
	-[ -d $(DESTDIR)$(infodir) ]     || $(INSTALL) -d $(DESTDIR)$(infodir)
	-[ -d $(DESTDIR)$(mandir) ]      || $(INSTALL) -d $(DESTDIR)$(mandir)
	-[ -d $(DESTDIR)$(mandir)/man1 ] || $(INSTALL) -d $(DESTDIR)$(mandir)/man1
	-[ -d $(DESTDIR)$(docdir) ]      || $(INSTALL) -d $(DESTDIR)$(docdir)

install: libakfavatar.so libakfavatar.a avatarsay-d installdirs install-info install-man
	$(INSTALL_DATA) $(srcdir)/akfavatar.h $(DESTDIR)$(includedir)
	$(INSTALL_DATA) $(srcdir)/avtaddons.h $(DESTDIR)$(includedir)
	$(INSTALL_DATA) $(LIBNAME) $(DESTDIR)$(libdir)
	-ln -sf $(LIBNAME) $(DESTDIR)$(libdir)/libakfavatar.so
	$(INSTALL_DATA) libakfavatar.a $(DESTDIR)$(libdir)
	$(INSTALL_DATA) libavtaddons.a $(DESTDIR)$(libdir)
	-$(LDCONFIG) $(libdir)
	$(INSTALL_PROGRAM) avatarsay-d $(DESTDIR)$(bindir)/avatarsay
	$(INSTALL_PROGRAM) lua-akfavatar-d $(DESTDIR)$(bindir)/lua-akfavatar
	$(INSTALL_PROGRAM) $(srcdir)/avtman $(DESTDIR)$(bindir)
	$(INSTALL_PROGRAM) $(srcdir)/gnome-akfavatar $(DESTDIR)$(bindir)
	$(INSTALL_PROGRAM) $(srcdir)/avtcmd $(DESTDIR)$(bindir)
	$(INSTALL_DATA) $(srcdir)/README $(DESTDIR)$(docdir)
	$(INSTALL_DATA) $(srcdir)/AUTHORS $(DESTDIR)$(docdir)
	$(INSTALL_DATA) $(srcdir)/COPYING $(DESTDIR)$(docdir)
	@echo '*'
	@echo '* make install-desktop-menu: to install avatarsay in a desktop menu'
	@echo '*'

install-strip: libakfavatar.so libakfavatar.a avatarsay-d installdirs install-info install-man
	$(INSTALL_DATA) $(srcdir)/akfavatar.h $(DESTDIR)$(includedir)
	$(INSTALL_DATA) $(srcdir)/avtaddons.h $(DESTDIR)$(includedir)
	$(INSTALL_DATA) -s $(LIBNAME) $(DESTDIR)$(libdir)
	-ln -sf $(LIBNAME) $(DESTDIR)$(libdir)/libakfavatar.so
	$(INSTALL_DATA) libakfavatar.a $(DESTDIR)$(libdir)
	$(INSTALL_DATA) libavtaddons.a $(DESTDIR)$(libdir)
	-$(LDCONFIG) $(libdir)
	$(INSTALL_PROGRAM) -s avatarsay-d $(DESTDIR)$(bindir)/avatarsay
	$(INSTALL_PROGRAM) -s lua-akfavatar-d $(DESTDIR)$(bindir)/lua-akfavatar
	$(INSTALL_PROGRAM) $(srcdir)/avtman $(DESTDIR)$(bindir)
	$(INSTALL_PROGRAM) $(srcdir)/gnome-akfavatar $(DESTDIR)$(bindir)
	$(INSTALL_PROGRAM) $(srcdir)/avtcmd $(DESTDIR)$(bindir)
	$(INSTALL_DATA) $(srcdir)/README $(DESTDIR)$(docdir)
	$(INSTALL_DATA) $(srcdir)/AUTHORS $(DESTDIR)$(docdir)
	$(INSTALL_DATA) $(srcdir)/COPYING $(DESTDIR)$(docdir)
	@echo '*'
	@echo '* use "make install-desktop-menu" to install avatarsay in a desktop menu'
	@echo '*'

install-desktop-menu: $(srcdir)/akfavatar.xpm $(srcdir)/akfoerster-avatarsay.desktop
	xdg-icon-resource install --size 32 --novendor $(srcdir)/akfavatar.xpm
	xdg-desktop-menu install $(srcdir)/akfoerster-avatarsay.desktop
	xdg-desktop-menu install $(srcdir)/akfoerster-lua-akfavatar.desktop

uninstall: uninstall-info uninstall-man uninstall-txt uninstall-html \
           uninstall-dvi uninstall-ps uninstall-pdf
	-rm -f $(includedir)/akfavatar.h
	-rm -f $(includedir)/avtaddons.h
	-rm -f $(includedir)/avtcio.h # from old installations
	-rm -f $(libdir)/$(LIBNAME)
	-rm -f $(libdir)/$(SONAME)
	-rm -f $(libdir)/libakfavatar.so
	-rm -f $(libdir)/libakfavatar.a
	-rm -f $(libdir)/libavtaddons.a
	-rm -f $(libdir)/libavtcio.a # from old installations
	-rm -f $(bindir)/avatarsay
	-rm -f $(bindir)/lua-akfavatar
	-rm -f $(bindir)/avtman
	-rm -f $(bindir)/gnome-akfavatar
	-rm -f $(docdir)/README
	-rm -f $(docdir)/AUTHORS
	-rm -f $(docdir)/COPYING
	-xdg-desktop-menu uninstall akfoerster-avatarsay.desktop
	-xdg-icon-resource uninstall --size 32 --novendor akfavatar.xpm

info:
	$(MAKE) -f $(srcdir)/doc/Makefile srcdir=$(srcdir) info

install-info: info
	$(INSTALL_DATA) $(srcdir)/doc/akfavatar-en.info $(DESTDIR)$(infodir)
	$(INSTALL_DATA) $(srcdir)/doc/akfavatar-de.info $(DESTDIR)$(infodir)
	-install-info --info-dir=$(DESTDIR)$(infodir) \
	   $(DESTDIR)$(infodir)/akfavatar-en.info 
	-install-info --info-dir=$(DESTDIR)$(infodir) \
	   $(DESTDIR)$(infodir)/akfavatar-de.info 

uninstall-info:
	-install-info --remove --info-dir=$(DESTDIR)$(infodir) \
	  $(DESTDIR)$(infodir)/akfavatar-en.info 
	-rm -f $(DESTDIR)$(infodir)/akfavatar-en.info
	-install-info --remove --info-dir=$(DESTDIR)$(infodir) \
	  $(DESTDIR)$(infodir)/akfavatar-de.info 
	-rm -f $(DESTDIR)$(infodir)/akfavatar-de.info

install-man: man
	-$(INSTALL_DATA) $(srcdir)/doc/avatarsay.1 $(DESTDIR)$(mandir)/man1
	-$(INSTALL_DATA) $(srcdir)/doc/avtcmd.1 $(DESTDIR)$(mandir)/man1

uninstall-man:
	-rm -f $(DESTDIR)$(mandir)/man1/avatarsay.1 
	-rm -f $(DESTDIR)$(mandir)/man1/avtcmd.1

txt:
	$(MAKE) -f $(srcdir)/doc/Makefile srcdir=$(srcdir) txt

install-txt: txt
	-$(INSTALL_DATA) akfavatar-en.txt $(DESTDIR)$(docdir)
	-$(INSTALL_DATA) akfavatar-de.txt $(DESTDIR)$(docdir)

uninstall-txt:
	-rm -f $(DESTDIR)$(docdir)/akfavatar-en.txt
	-rm -f $(DESTDIR)$(docdir)/akfavatar-de.txt

html:
	$(MAKE) -f $(srcdir)/doc/Makefile srcdir=$(srcdir) html

install-html: html
	-$(INSTALL_DATA) akfavatar-en.html $(DESTDIR)$(docdir)
	-$(INSTALL_DATA) akfavatar-de.html $(DESTDIR)$(docdir)

uninstall-html:
	-rm -f $(DESTDIR)$(docdir)/akfavatar-en.html
	-rm -f $(DESTDIR)$(docdir)/akfavatar-de.html

dvi:
	$(MAKE) -f $(srcdir)/doc/Makefile srcdir=$(srcdir) dvi

install-dvi: dvi
	-$(INSTALL_DATA) akfavatar-en.dvi $(DESTDIR)$(docdir)
	-$(INSTALL_DATA) akfavatar-de.dvi $(DESTDIR)$(docdir)

uninstall-dvi:
	-rm -f $(DESTDIR)$(docdir)/akfavatar-en.dvi
	-rm -f $(DESTDIR)$(docdir)/akfavatar-de.dvi

pdf:
	$(MAKE) -f $(srcdir)/doc/Makefile srcdir=$(srcdir) pdf

install-pdf: pdf
	-$(INSTALL_DATA) akfavatar-en.pdf $(DESTDIR)$(docdir)
	-$(INSTALL_DATA) akfavatar-de.pdf $(DESTDIR)$(docdir)

uninstall-pdf:
	-rm -f $(DESTDIR)$(docdir)/akfavatar-en.pdf
	-rm -f $(DESTDIR)$(docdir)/akfavatar-de.pdf

ps:
	$(MAKE) -f $(srcdir)/doc/Makefile srcdir=$(srcdir) ps

install-ps: ps
	-$(INSTALL_DATA) akfavatar-en.ps $(DESTDIR)$(docdir)
	-$(INSTALL_DATA) akfavatar-de.ps $(DESTDIR)$(docdir)

uninstall-ps:
	-rm -f $(DESTDIR)$(docdir)/akfavatar-en.ps
	-rm -f $(DESTDIR)$(docdir)/akfavatar-de.ps

man:
	$(MAKE) -f $(srcdir)/doc/Makefile srcdir=$(srcdir) man

doc:
	$(MAKE) -f $(srcdir)/doc/Makefile srcdir=$(srcdir) all

check:

clean:
	-rm -f *~
	-rm -f *.o *.lo
	-rm -f *.ppu *.gpi *.gpm
	-rm -f bdfread
	-rm -f alert.c
	-rm -f rgb.h
	-rm -f ucsfont9x18.c ucsfont7x14.c
	-rm -f libinfo.rc avtsayinfo.rc
	-rm -fr akfavatar-en.t2d/ akfavatar-de.t2d/
	-rm -f pascal/*.o pascal/*.gpi pascal/*.gpm pascal/*.ppu
	-rm -f pascal/link.res pascal/ppas.sh

mostlyclean: clean

distclean: clean
	-rm -f avatarsay avatarsay-d avatarsay-s example
	-rm -f example a.out *.a *.so
	-rm -f $(LIBNAME) $(SONAME)
	-rm -f config.status
	-rm -f version.h
	-rm -f version.texi
	-rm -f Makefile
	-rm -f akfavatar-*.tar.gz akfavatar-*.tar.bz2
	-rm -f multiply-bin multiply
	-rm -f multiplizieren-bin multiplizieren
	-rm -f multiplizieren.exe multiply.exe example.exe
	-rm -f akfavatar.def akfavatar.dll akfavatar.lib
	-rm -f akfavatar-en.pdf akfavatar-en.ps akfavatar-en.dvi
	-rm -f akfavatar-en.txt akfavatar-en.xml
	-rm -f akfavatar-de.pdf akfavatar-de.ps akfavatar-de.dvi
	-rm -f akfavatar-de.txt akfavatar-de.xml
	-rm -f avatarsay*.exe akfavatar-*.zip
	-rm -f config-mingw


# the rest is just for the maintainer
# don't use it unless you know what you are doing

everything: all multiply multiplizieren

maintainer-clean: distclean
	@echo 'This command is intended for maintainers to use; it'
	@echo 'deletes files that may need special tools to rebuild.'
	rm -f $(srcdir)/alert.au
	$(MAKE) -C $(srcdir)/doc maintainer-clean

maintainerclean: maintainer-clean

multiply: $(srcdir)/pascal/multiply.pas
	-$(srcdir)/pascal/fpcavatar -dRELEASE -FE. -o$@ \
	    -Fi$(srcdir)/pascal \
	    $(srcdir)/pascal/multiply.pas $(LOCAL_FPC_RPATH)

multiplizieren: $(srcdir)/pascal/multiply.pas
	-$(srcdir)/pascal/fpcavatar -dRELEASE -ddeutsch -FE. -o$@ \
	    -Fi$(srcdir)/pascal \
	    $(srcdir)/pascal/multiply.pas $(LOCAL_FPC_RPATH)

dist: info html man
	mkdir $(PKGNAME)
	ln README INSTALL AUTHORS COPYING ChangeLog lrun \
	   avatar.c akfavatar.h avatar-audio.c avatar-default.c \
	   avtccio.c avtcwio.c avtaddons.h filechooser.c avtreadfile.c \
	   colorchooser.c \
	   balloonpointer.xbm circle.xbm gnu-head.xpm gnu-head.xbm \
	   male_user.xpm female_user.xpm teacher.xpm \
	   btn.xpm btn_up.xbm btn_down.xbm btn_left.xbm btn_right.xbm \
	   btn_no.xbm btn_yes.xbm btn_cancel.xbm btn_ff.xbm btn_fb.xbm \
	   btn_pause.xbm btn_stop.xbm btn_help.xbm btn_eject.xbm \
	   btn_circle.xbm \
	   avatarsay.c avtposix.c avtterm.c avttermsys.h avttermsys.c \
	   avtmsg.c arch.c rgb.txt \
	   avtman avtcmd example.c fsdemo-??.avt \
	   gnome-akfavatar akfoerster-avatarsay.desktop \
	   akfavatar.xpm info.xpm \
	   7x14.bdf 9x18.bdf bdf2c font.c \
	   alert.flac alert.au \
	   configure Makefile.in text2c data2c rgb2c \
	   $(PKGNAME)/

	mkdir $(PKGNAME)/pascal
	ln pascal/README pascal/akfavatar.pas pascal/example.pas \
	   pascal/multiply.pas \
	   pascal/positive.au pascal/negative.au pascal/neutral.au \
	   pascal/positive.inc pascal/negative.inc \
	   pascal/xpm2pas pascal/xbm2pas \
	   pascal/gpcavatar pascal/fpcavatar \
	   $(PKGNAME)/pascal/
	
	mkdir $(PKGNAME)/lua
	ln lua/Makefile.w32 lua/lua-avt.c \
	   lua/lua-akfavatar-prg.c \
	   lua/interactive.lua lua/hello.lua lua/multiply.lua \
	   lua/man.lua lua/textview.lua \
	   $(PKGNAME)/lua/

	mkdir $(PKGNAME)/doc
	ln doc/README doc/Makefile doc/avatarsay.1 doc/avtcmd.1 \
	   doc/akfavatar-en.texinfo doc/akfavatar-en.info \
	   doc/pasref.txt \
	   doc/akfavatar-en.html \
	   doc/akfavatar-de.texinfo doc/akfavatar-de.info \
	   doc/akfavatar-de.html \
	   doc/akfavatar.css \
	   doc/pdfmeta-en doc/pdfmeta-de \
	   $(PKGNAME)/doc/

	mkdir $(PKGNAME)/mingw
	ln mingw/akfavatar.ico mingw/icon.rc \
	   mingw/libinfo.in mingw/avtsayinfo.in mingw/lua-akfavatar-rc.in \
	   mingw/avtmsg.c mingw/avtwindows.c \
	   mingw/avttermstub.c mingw/askdrive.c \
	   mingw/Makefile mingw/README \
	   $(PKGNAME)/mingw/

	tar -cvf $(PKGNAME).tar $(PKGNAME)/
	rm -rf $(PKGNAME)/
	bzip2 -f $(PKGNAME).tar

dist-bin: avatarsay lua-akfavatar lua-akfavatar.so info html
	mkdir $(BINPKGNAME)
	cp $(LIBNAME) $(BINPKGNAME)/
	cp avatarsay $(BINPKGNAME)/
	-ln -sf $(LIBNAME) $(BINPKGNAME)/$(SONAME)
	-cp lua-akfavatar lua-akfavatar.so $(BINPKGNAME)/
	ln $(srcdir)/akfavatar.h $(srcdir)/pascal/akfavatar.pas $(BINPKGNAME)/
	ln $(srcdir)/pascal/?pcavatar $(BINPKGNAME)/
	ln $(srcdir)/gnu-head.xpm $(srcdir)/gnu-head.xbm $(BINPKGNAME)/
	ln $(srcdir)/female_user.xpm $(srcdir)/male_user.xpm $(BINPKGNAME)/
	ln $(srcdir)/teacher.xpm $(BINPKGNAME)/
	ln $(srcdir)/lua/interactive.lua $(srcdir)/lua/multiply.lua $(BINPKGNAME)/
	ln $(srcdir)/lua/hello.lua $(BINPKGNAME)/
	ln $(srcdir)/lua/man.lua $(srcdir)/lua/textview.lua $(BINPKGNAME)/
	ln $(srcdir)/COPYING $(srcdir)/AUTHORS $(srcdir)/avtman \
	   $(srcdir)/fsdemo-??.avt \
	   $(srcdir)/gnome-akfavatar \
	   $(srcdir)/avtcmd \
	   $(BINPKGNAME)/
	ln $(srcdir)/doc/akfavatar-??.html $(BINPKGNAME)/
	ln $(srcdir)/doc/akfavatar-??.info $(BINPKGNAME)/
	tar -cvf $(BINPKGNAME).$(SYSTEM).$(ARCH).tar $(BINPKGNAME)/
	rm -rf $(BINPKGNAME)/
	bzip2 -f $(BINPKGNAME).$(SYSTEM).$(ARCH).tar
